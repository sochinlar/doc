# 接入管理

&emsp;Lanture物联网平台支持CoAP,MQTT,TCP,UDP设备接入功能。针对CoAP协议设备接入，分为默认设备及电信卡设备接入。

## 电信NB卡设备接入

### 创建电信NB卡设备

&emsp;登录[澜创物联网平台](http://iot-api.lantrue.net "澜创物联网")，进入设备管理页面，点击添加按钮添加一个电信NB卡的设备。如下图
<img :src="$withBase('/img/ctDeviceAdd.png')" alt="addCtDevice">

::: tip 注意事项：
- 产品名称选择，必须选择一个协议类型为CoAP的产品名称，才会出现运营商选择框。
- 运营商选择‘电信设备’
- 产品ID，必须使用设备的 IMEI 唯一码！！！
:::

### 设备接入信息

&emsp;添加完设备后，就可以进行设备接入测试了，设备控制说明如下

    //报错查询
    AT+CMEE=1
    //关机
    AT+CFUN=0
    //查询IMEI-------获取IMEI号码
    AT+CGSN=1
    //设置ID-------下划线部分必须填写获取的IMEI号码，否则可能造成不可逆绑定
    AT+NTSETID=1,869029030558919
    //设置对接IP端口
    AT+NCDP=180.101.147.115,5683
    //开机
    AT+CFUN=1
    //设置频段
    AT+NBAND=5
    //设置APN
    AT+CGDCONT=1,"IP","CTNB"
    //入网
    AT+CGATT=1
    //获取终端IP
    AT+CGPADDR
    //发送上行数据----0002：两个数据
    AT+NMGS=4,0000026566
    //接收下行数据
    AT+NQMGR
    //读取数据
    AT+NMGR

::: tip 重要事项
- 设置ID : 设备IEMI码，如869029030558919
- 对接IP端口 : 180.101.147.115,5683
- 上行数据： 设备发送数据格式xxffff***** --xx为消息类型ID，固定为十六进制00，ffff表示4位十六进制数，它们用来指定消息内容*****的长度，如消息内容为hello word!那么消息长度为11，用4位十六进制数表示就是000b,*****表示可变长度的十六进制消息内容，如要发送hello word!，先将hello word!转化成十六进制字符串为68656c6c6f20776f726421所以设备要发送数据hello world! 那么实际上需要发送的是十六进制字符串00000b68656c6c6f20776f726421
- 下行数据： 设备接收的指令内容，收到的消息格式同上行数据发送格式xxffff***** 只不过消息类型ID，固定为十六进制01，如当收到01000b68656c6c6f20776f726421消息时，通过01知道是下行指令，000b解析成十进制数为11，知道消息长度为11，68656c6c6f20776f726421转为十进制字符串为hello word!
:::
